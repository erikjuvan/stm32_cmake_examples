////////////////////////////////////////////////////////////////////////////////
// COPYRIGHT (c) 2020
// EMTAS, EMSISO
// All rights reserved.
////////////////////////////////////////////////////////////////////////////////
/**
*@file      canopen_if.c
*@brief     canopen interface
*@author    Zdenko Mezgec
*@date      14.12.2020
*@version   V1.2.0
*/
////////////////////////////////////////////////////////////////////////////////
/**
*@addtogroup CANOPEN_INTERFACE
* @{ <!-- BEGIN GROUP -->
*/
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Includes
////////////////////////////////////////////////////////////////////////////////
#include "canopen_cfg.h"
#include "CANopen/co_canopen.h"

////////////////////////////////////////////////////////////////////////////////
// Definitions
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Variables
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Function prototypes
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Functions
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
/**
*   callback fnc for manipulating with Green led according to canopen standard
*
* @param[in]    on      led on or off
* @return       void
*/
////////////////////////////////////////////////////////////////////////////////
void co_ledgreenind(BOOL_T on)
{
    if (on == CO_TRUE)
    {

    }
    else
    {

    }
}

////////////////////////////////////////////////////////////////////////////////
/**
*   callback fnc for manipulating with Red led according to canopen standard
*
* @param[in]    on      led on or off
* @return       void
*/
////////////////////////////////////////////////////////////////////////////////
void co_ledredind(BOOL_T on)
{
    if (on == CO_TRUE)
    {

    }
    else
    {

    }
}

////////////////////////////////////////////////////////////////////////////////
/**
*   callback fnc for sdo pre write.
*
*   This is used to check if desired write value on particular object is inside desired limits or permissions. To prevent writing, return desired RET_T status
*
* @param[in]    index       object index
* @param[in]    subIndex    object subindex
* @param[in]    pData       object data
* @return       RET_T       status
*/
////////////////////////////////////////////////////////////////////////////////
RET_T co_sdoservercheckwriteind(UNSIGNED16 index, UNSIGNED8 subIndex, const UNSIGNED8 *pData)
{
    // example for baudrate check write
    if ((index == 0x2001) && (subIndex == 0))
    {
        UNSIGNED16 ui_bitrate;

        ui_bitrate =  (UNSIGNED8)(pData[1]);
        ui_bitrate =  (ui_bitrate<<8)&0xff00;
        ui_bitrate |= (UNSIGNED8)(pData[0]);

        if ((ui_bitrate != 20)&&
            (ui_bitrate != 50)&&
            (ui_bitrate != 125)&&
            (ui_bitrate != 250)&&
            (ui_bitrate != 500)&&
            (ui_bitrate != 800)&&
            (ui_bitrate != 1000))
        {
            return (RET_SDO_INVALID_VALUE);
        }
        return(RET_OK);
    }

    return(RET_OK);
}

////////////////////////////////////////////////////////////////////////////////
/**
*   callback fnc to save parameters to nvm
*
* @param[in]    sub     subindex value according to standard to determine which parameters should be saved. Usually we don't care about this
* @return       RET_T   status
*/
////////////////////////////////////////////////////////////////////////////////
RET_T co_saveind(UNSIGNED8 sub)
{
    return(RET_OK);
}

////////////////////////////////////////////////////////////////////////////////
/**
*   callback fnc to set parameters to default
*
* @param[in]    sub     subindex value according to standard to determine which parameters should be cleared. Usually we don't care about this
* @return       RET_T   status
*/
////////////////////////////////////////////////////////////////////////////////
RET_T co_clearind(UNSIGNED8 sub)
{
    return(RET_OK);
}

////////////////////////////////////////////////////////////////////////////////
/**
*   callback fnc to load parameters to nvm
*
* @param[in]    sub     subindex value according to standard to determine which parameters should be load. Usually we don't care about this
* @return       RET_T   status
*/
////////////////////////////////////////////////////////////////////////////////
RET_T co_loadind(UNSIGNED8 sub)
{
    return(RET_OK);
}

////////////////////////////////////////////////////////////////////////////////
/**
*   callback fnc to setup all string data related objects
*
* @return       void
*/
////////////////////////////////////////////////////////////////////////////////
void co_setup_string_object_data(void)
{
    co_setup_vis_string(CO_vis_string_Drive_manufacturer        ,"EMSISO");
    co_setup_vis_string(CO_vis_string_Manufacturer_Device_Name  ,"emDrive V2");
}

////////////////////////////////////////////////////////////////////////////////
/**
* @} <!-- END GROUP -->
*/
////////////////////////////////////////////////////////////////////////////////

	




