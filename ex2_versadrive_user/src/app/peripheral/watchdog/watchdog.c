////////////////////////////////////////////////////////////////////////////////
// COPYRIGHT (c) 2021
// EMSISO
// All rights reserved.
////////////////////////////////////////////////////////////////////////////////

/**
 * @file     watchdog.c
 * @brief    Functions for watchdog
 * @author   Haris Kovacevic
 * @date     08.03.2021
 * @version  V1.0.0
 */

////////////////////////////////////////////////////////////////////////////////
/**
 * @addtogroup WATCHDOG_MODULE
 * @{ <!-- BEGIN GROUP -->
 */
////////////////////////////////////////////////////////////////////////////////

// @TODO:
// 1. Check if watchdog is properly initialized
// 2. Check if Watchdog is working properly
// 3. Every FOC cycle watchdog shall be kicked

////////////////////////////////////////////////////////////////////////////////
// Includes
////////////////////////////////////////////////////////////////////////////////
#include "watchdog.h"

////////////////////////////////////////////////////////////////////////////////
// Definitions
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Variables
////////////////////////////////////////////////////////////////////////////////
IWDG_HandleTypeDef g_hiwdg;

////////////////////////////////////////////////////////////////////////////////
// Function prototypes
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Functions
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
/*!
 * @brief        Function initializes watchdog
 *
 * @param[in]    None
 * @return       None
 */
////////////////////////////////////////////////////////////////////////////////
HAL_StatusTypeDef watchdog_init(void)
{
    HAL_StatusTypeDef init_status = HAL_OK;

    g_hiwdg.Instance       = IWDG;
    g_hiwdg.Init.Prescaler = IWDG_PRESCALER_4;
    g_hiwdg.Init.Window    = 0x0FFF;
    g_hiwdg.Init.Reload    = 4;

    if (HAL_IWDG_Init(&g_hiwdg) != HAL_OK)
    {
        init_status = HAL_ERROR;
    }

    return init_status;
}

////////////////////////////////////////////////////////////////////////////////
/*!
 * @brief        Function refreashes the watchdog timer
 *
 * @param[in]    None
 * @return       None
 */
////////////////////////////////////////////////////////////////////////////////
void watchdog_kick(void)
{
    // Refresh Watchdog timer
    HAL_IWDG_Refresh(&g_hiwdg);
}

////////////////////////////////////////////////////////////////////////////////
/**
 * @} <!-- END GROUP -->
 */
////////////////////////////////////////////////////////////////////////////////
