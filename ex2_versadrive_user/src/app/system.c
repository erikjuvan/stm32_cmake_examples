// EMSISO
// All rights reserved.
////////////////////////////////////////////////////////////////////////////////
/*!
 * @file     system.c
 * @note     System source files
 * @author   Marko Rman
 * @date     01.02.2021
 * @brief    Functions for system status
 */

////////////////////////////////////////////////////////////////////////////////
/*!
 * @addtogroup SYSTEM
 * @{ <!-- BEGIN GROUP -->
 */
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Includes
////////////////////////////////////////////////////////////////////////////////
#include "system.h"
#include <stdbool.h>
#include <stdint.h>

////////////////////////////////////////////////////////////////////////////////
// Definitions
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Variables
////////////////////////////////////////////////////////////////////////////////

/*
@! SYMBOL       = system_status
@! A2L_TYPE     = MEASURE
@! DATA_TYPE    = ULONG
@! DESCRIPTION  = "System Status. If System has initialized successfully this value shall be 0.\
Each bit represent failure in initialization of one module. Bit 0 - Manufacturer parameters\
fail, Bit 1 - Calibration parameters fail, Bit 2 - CANopen Stack fail, Bit 3 - Osci module\
fail, Bit 4 - Motor control module fail"
@! GROUP        = system_status
@! DIMENSION    = 1 1
@! UNIT         = "\"
@! CAN_INDEX    = 0x5100
@! CAN_SUBINDEX = 0
@! READ_LEVEL   = 5
@! WRITE_LEVEL  = 5
@! END
*/
volatile uint32_t system_status = eSYSTEM_INIT_OK;

////////////////////////////////////////////////////////////////////////////////
// Function prototypes
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Functions
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
/**
 * Function sets bit for corresponding module.
 *
 * @param   init_status - enum with failed module initialization
 * @return  void
 */
////////////////////////////////////////////////////////////////////////////////
void system_set_init_fail(system_init_status_t init_status)
{
    if ((system_status & init_status) == false)
    {
        system_status |= init_status;
    }
}

////////////////////////////////////////////////////////////////////////////////
/**
 * Returns status of initialization flags.
 *
 * If all modules initialized fine, the return value shall be eSYSTEM_INIT_OK.
 *
 *@return returns status
 */
////////////////////////////////////////////////////////////////////////////////
system_init_status_t system_get_init_status(void)
{
    return system_status;
}

////////////////////////////////////////////////////////////////////////////////
/*!
 * @} <!-- END GROUP -->
 */
////////////////////////////////////////////////////////////////////////////////
